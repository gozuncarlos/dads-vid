<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Diosdado M. Gozun</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@1,400;1,600&family=Lato:wght@300;400&display=swap" rel="stylesheet">

    <style>
        * { 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
            touch-action: pan-y; 
        }
        
        body, html { 
            margin: 0; padding: 0; 
            width: 100%; height: 100dvh; 
            background-color: #000; 
            overflow: hidden; 
            user-select: none; -webkit-user-select: none;
        }

        /* --- VISUAL LAYERS --- */
        #slideshow-container {
            position: fixed; top: 0; left: 0; 
            width: 100%; height: 100dvh; 
            z-index: 1;
            background: #000;
            opacity: 0; 
            visibility: hidden; 
            transition: opacity 2s ease;
        }

        .slide {
            position: absolute; top: 0; left: 0; 
            width: 100%; height: 100%;
            opacity: 0; 
            transition: opacity 1.5s ease-in-out;
            background-size: contain; 
            background-position: center; 
            background-repeat: no-repeat;
            will-change: opacity, transform;
        }

        .slide.active {
            opacity: 1; 
            animation: kenburns 15s linear infinite alternate;
        }

        @keyframes kenburns {
            from { transform: scale(1); }
            to { transform: scale(1.08); }
        }

        .blur-bg {
            position: absolute; top: 0; left: 0; 
            width: 100%; height: 100%;
            background-size: cover; background-position: center;
            filter: blur(30px) brightness(0.4); 
            z-index: -1;
            opacity: 0; 
            visibility: hidden;
            transition: opacity 2s ease;
            transform: scale(1.2); 
        }

        /* --- TEXT SCREENS --- */
        .screen-overlay {
            position: fixed; top: 0; left: 0; 
            width: 100%; height: 100dvh;
            z-index: 100; 
            display: flex; flex-direction: column;
            justify-content: center; align-items: center; text-align: center;
            pointer-events: none; 
            opacity: 0; transition: opacity 1.5s ease;
            background: radial-gradient(circle at center, #1f1f1f 0%, #000000 90%);
        }

        .screen-active { opacity: 1; pointer-events: auto; }

        h1 {
            font-family: 'Playfair Display', serif; font-style: italic; color: white;
            font-weight: 400; font-size: 8vmin; margin-bottom: 30px;
            text-shadow: 0 4px 10px rgba(0,0,0,0.5);
            line-height: 1.2;
        }

        .sub-text {
            font-family: 'Lato', sans-serif; color: #aaa;
            font-size: 4vmin; letter-spacing: 2px; margin-bottom: 15px;
            font-weight: 300; text-transform: uppercase;
        }

        /* --- BUTTONS --- */
        .btn-wrapper {
            width: 100px; height: 100px; 
            display: flex; justify-content: center; align-items: center; cursor: pointer;
        }
        .circle {
            width: 100%; height: 100%; border: 1px solid rgba(255,255,255,0.4);
            border-radius: 50%; animation: pulse 2s infinite;
        }
        .play-text {
            position: absolute; font-family: 'Lato', sans-serif; color: white;
            font-size: 14px; letter-spacing: 2px; text-transform: uppercase;
        }

        #controls {
            position: fixed; bottom: 30px; 
            padding-bottom: env(safe-area-inset-bottom);
            left: 0; width: 100%; z-index: 50;
            display: flex; justify-content: center; gap: 20px; 
            opacity: 0; transition: opacity 0.5s;
            pointer-events: none; 
        }
        
        #controls.visible { opacity: 1; pointer-events: auto; }

        .ctrl-btn {
            background: rgba(255,255,255,0.1); backdrop-filter: blur(10px);
            border-radius: 30px; border: 1px solid rgba(255,255,255,0.2); 
            color: white; font-family: 'Lato', sans-serif; font-size: 12px; 
            text-transform: uppercase; letter-spacing: 1px; 
            padding: 12px 24px; cursor: pointer;
        }

        .replay-btn {
            margin-top: 40px; padding: 15px 35px;
            border: 1px solid rgba(255,255,255,0.3);
            color: white; background: transparent;
            font-family: 'Lato', sans-serif; text-transform: uppercase;
            letter-spacing: 2px; cursor: pointer;
        }

        .swipe-hint {
            position: fixed; bottom: 100px; width: 100%; text-align: center;
            color: rgba(255,255,255,0.5); font-family: 'Lato'; font-size: 12px;
            text-transform: uppercase; letter-spacing: 2px;
            opacity: 0; transition: opacity 1s; pointer-events: none;
            padding-bottom: env(safe-area-inset-bottom);
        }

        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255,255,255,0.4); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(255,255,255,0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255,255,255,0); }
        }
    </style>
</head>
<body>

    <div class="blur-bg" id="bg-layer"></div>
    <div id="slideshow-container" onclick="toggleControls()"></div>

    <!-- 1. INTRO SCREEN -->
    <div id="intro-sequence" class="screen-overlay" style="background: black;">
        <div class="sub-text">Remembering the memories of</div>
        <h1 style="margin:0; font-size: 7vmin;">Diosdado M. Gozun</h1>
    </div>

    <!-- 2. START OVERLAY -->
    <div id="start-overlay" class="screen-overlay screen-active">
        <h1>In Loving<br>Memory</h1>
        <div class="btn-wrapper" onclick="startExperience()">
            <div class="circle"></div>
            <div class="play-text">Enter</div>
        </div>
        <div style="margin-top: 20px; font-family: 'Lato'; color: #666; font-size: 12px;">Turn on sound</div>
    </div>

    <!-- 3. ENDING SCREEN -->
    <div id="end-overlay" class="screen-overlay">
        <h1>Forever in<br>Our Hearts</h1>
        <div class="sub-text" style="font-size: 2.5vmin; margin-top: 10px;">Thank you for the memories</div>
        <button class="replay-btn" onclick="location.reload()">Replay Tribute</button>
    </div>

    <div id="swipe-hint" class="swipe-hint">Swipe left or right</div>

    <div id="controls" class="visible">
        <button class="ctrl-btn" onclick="prevSlide(event)">Prev</button>
        <button class="ctrl-btn" id="pause-btn" onclick="togglePause(event)">Pause</button>
        <button class="ctrl-btn" onclick="nextSlide(event)">Next</button>
    </div>

    <audio id="bg-music" preload="auto"></audio>

    <script>
        // CONFIG
        // NOTE: On GitHub, filenames are case-sensitive!
        // Ensure your file is named "music.mp3" inside a "music" folder.
        const playlist = [
            "music/music.mp3"
        ];

        const images = [];
        // NOTE: Ensure images are named "photo1.jpg" (lowercase jpg)
        for (let i = 1; i <= 46; i++) {
            images.push(`./images/photo${i}.jpg`);
        }

        const slideDuration = 6000; 

        // STATE
        let currentIndex = 0;
        let currentTrackIndex = 0;
        let slideInterval;
        let isPlaying = true;
        let isEnding = false;
        let touchStartX = 0;
        let touchEndX = 0;

        const container = document.getElementById('slideshow-container');
        const bgLayer = document.getElementById('bg-layer');
        const audio = document.getElementById('bg-music');
        const controls = document.getElementById('controls');

        // ERROR HANDLING
        audio.addEventListener('error', function(e) {
            console.error("Audio Error:", e);
            // This alert helps you verify if the file is missing on GitHub
            alert("Audio file not found. Please check that your file on GitHub is named 'music.mp3' (lowercase) inside the 'music' folder.");
        });

        // SWIPE LOGIC
        container.addEventListener('touchstart', e => { touchStartX = e.changedTouches[0].screenX; }, {passive: true});
        container.addEventListener('touchend', e => { 
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        }, {passive: true});

        function handleSwipe() {
            if(isEnding) return;
            const threshold = 50; 
            if (touchEndX < touchStartX - threshold) { nextSlide(); resetTimer(); }
            if (touchEndX > touchStartX + threshold) { prevSlide(); resetTimer(); }
        }

        function toggleControls() {
            if(isEnding) return;
            controls.classList.toggle('visible');
        }

        // MUSIC
        function initMusic() {
            audio.src = playlist[0];
            // audio.load() is technically called by setting src, but explicit load is fine
            audio.load();
            audio.onended = function() {
                if(isEnding) return;
                currentTrackIndex = (currentTrackIndex + 1) % playlist.length;
                audio.src = playlist[currentTrackIndex];
                audio.play().catch(e => console.log("Auto-play blocked:", e));
            };
        }

        // SLIDES
        function initSlides() {
            images.forEach((url, index) => {
                const slide = document.createElement('div');
                slide.className = 'slide';
                if(index === 0) slide.classList.add('active');
                slide.style.backgroundImage = `url('${url}')`;
                container.appendChild(slide);
            });
            bgLayer.style.backgroundImage = `url('${images[0]}')`;
        }

        function showSlide(index) {
            const slides = document.querySelectorAll('.slide');
            slides.forEach(s => s.classList.remove('active'));
            slides[index].classList.add('active');
            bgLayer.style.backgroundImage = `url('${images[index]}')`;
        }

        function nextSlide(e) {
            if(e) e.stopPropagation(); 
            if (isEnding) return;
            if (currentIndex >= images.length - 1) { triggerEnding(); return; }
            currentIndex++;
            showSlide(currentIndex);
        }

        function prevSlide(e) {
            if(e) e.stopPropagation();
            if (currentIndex > 0) { currentIndex--; showSlide(currentIndex); }
        }

        function startAutoPlay() {
            clearInterval(slideInterval);
            slideInterval = setInterval(nextSlide, slideDuration);
        }

        function resetTimer() { if(isPlaying) startAutoPlay(); }

        function togglePause(e) {
            if(e) e.stopPropagation();
            if(isEnding) return;
            const btn = document.getElementById('pause-btn');
            if(isPlaying) {
                clearInterval(slideInterval);
                btn.innerText = "Play";
                isPlaying = false;
            } else {
                nextSlide();
                startAutoPlay();
                btn.innerText = "Pause";
                isPlaying = true;
            }
        }

        // SEQUENCES
        function triggerEnding() {
            isEnding = true;
            clearInterval(slideInterval);
            setTimeout(() => {
                controls.classList.remove('visible');
                container.style.opacity = '0';
                bgLayer.style.opacity = '0';
                document.getElementById('swipe-hint').style.opacity = '0';
                fadeOutAudio();
                document.getElementById('end-overlay').classList.add('screen-active');
            }, 5000); 
        }

        function fadeOutAudio() {
            let fade = setInterval(function () {
                if ((audio.volume > 0.1)) { audio.volume -= 0.1; } else { clearInterval(fade); audio.pause(); }
            }, 400);
        }

        function startExperience() {
            const startScreen = document.getElementById('start-overlay');
            const introScreen = document.getElementById('intro-sequence');
            const hint = document.getElementById('swipe-hint');
            
            // Re-load to ensure mobile browsers are happy with the user interaction
            if (audio.paused) {
                audio.play().then(() => {
                    audio.volume = 1.0;
                }).catch(e => {
                    console.log("Audio play error", e);
                    alert("Could not play audio. Check file path.");
                });
            }

            startScreen.classList.remove('screen-active');
            introScreen.classList.add('screen-active');

            // INTRO DURATION: 4.5 seconds
            setTimeout(() => {
                introScreen.classList.remove('screen-active');
                
                // UNLOCK VISIBILITY NOW (Prevents ghosting)
                container.style.visibility = 'visible';
                bgLayer.style.visibility = 'visible';
                
                // START FADE IN
